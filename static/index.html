<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Pal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-hover: #7c3aed;
            --secondary: #3b82f6;
            --bg-color: #0f172a;
            --sidebar-bg: rgba(15, 23, 42, 0.7);
            --sidebar-text: #f8fafc;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            background-color: var(--bg-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
            perspective: 1000px;
        }

        /* 3D Anime.js Background Grid */
        #anime-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
            cursor: pointer;
            /* Initially acts as a giant button */
        }

        .anime-grid {
            display: grid;
            transform-style: preserve-3d;
            transform: rotateX(60deg) rotateZ(45deg);
            gap: 12px;
        }

        .anime-grid-item {
            width: 50px;
            height: 50px;
            background: rgba(139, 92, 246, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            transform-style: preserve-3d;
            position: relative;
            transition: background-color 0.3s;
        }

        .anime-grid-item:hover {
            background: rgba(139, 92, 246, 0.4);
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: white;
            pointer-events: none;
            z-index: 1;
        }

        /* Showcase Intro Scene */
        .intro-container {
            position: absolute;
            z-index: 20;
            text-align: center;
            pointer-events: none;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(100px);
            width: 100%;
        }

        .intro-title {
            font-size: 5rem;
            font-weight: 800;
            color: transparent;
            background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            letter-spacing: -2px;
            margin: 0;
            opacity: 0;
            text-shadow: 0px 10px 30px rgba(59, 130, 246, 0.4);
        }

        .intro-subtitle {
            font-size: 1.5rem;
            color: #cbd5e1;
            margin-top: 10px;
            opacity: 0;
            font-weight: 300;
            letter-spacing: 4px;
        }

        .click-to-start {
            margin-top: 50px;
            font-size: 1rem;
            color: #a855f7;
            opacity: 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: 600;
        }

        /* Main Application Layout (Hidden Initially) */
        #app-wrapper {
            display: none;
            opacity: 0;
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: var(--sidebar-text);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.5);
            pointer-events: auto;
            opacity: 0;
            /* Animated in later */
        }

        .sidebar h2 {
            padding: 30px 20px;
            margin: 0;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            color: transparent;
            text-align: center;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-links {
            list-style: none;
            padding: 20px 0;
            margin: 0;
            flex: 1;
        }

        .nav-links li {
            padding: 16px 30px;
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 1.05rem;
            color: #cbd5e1;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .nav-links li:hover {
            background-color: rgba(255, 255, 255, 0.05);
            padding-left: 35px;
            color: white;
        }

        .nav-links li.active {
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.2) 0%, transparent 100%);
            color: #a855f7;
            border-left: 4px solid #a855f7;
        }

        .main-content {
            flex: 1;
            padding: 50px;
            overflow-y: auto;
            position: relative;
            pointer-events: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .main-content::-webkit-scrollbar {
            display: none;
        }

        .section {
            display: none;
            width: 100%;
            max-width: 850px;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding: 45px;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform-origin: center top;
        }

        .section.active {
            display: block;
        }

        h3 {
            margin-top: 0;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f8fafc 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        p.subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 30px;
            margin-top: 5px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #cbd5e1;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1.05rem;
            box-sizing: border-box;
            font-family: inherit;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input::placeholder,
        textarea::placeholder {
            color: #475569;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.4);
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        textarea {
            resize: vertical;
            height: 140px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 1.05rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 15px -3px rgba(139, 92, 246, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.2) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -5px rgba(139, 92, 246, 0.4);
        }

        button:hover::after {
            opacity: 1;
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        button.success-btn {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);
        }

        button.success-btn:hover {
            box-shadow: 0 15px 25px -5px rgba(16, 185, 129, 0.4);
        }

        button.outlined-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: #a855f7;
            box-shadow: none;
        }

        button.outlined-btn:hover {
            background: rgba(139, 92, 246, 0.1);
            box-shadow: none;
        }

        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 12px;
        }

        .loading .spinner {
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .output-area {
            margin-top: 40px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: none;
        }

        .output-area.visible {
            display: block;
        }

        h4 {
            margin-top: 0;
            font-size: 1.4rem;
            color: #f8fafc;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        th,
        td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        th {
            background-color: rgba(0, 0, 0, 0.4);
            font-weight: 600;
            color: #cbd5e1;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .question-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateX(5px);
        }

        .options-list {
            list-style: none;
            padding-left: 0;
            margin-top: 15px;
        }

        .options-list li {
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.2);
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .options-list li:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .options-list input[type="radio"] {
            margin-right: 15px;
            accent-color: var(--primary);
            transform: scale(1.2);
            cursor: pointer;
        }

        .options-list label {
            cursor: pointer;
            margin: 0;
            width: 100%;
        }

        .tips-list {
            padding-left: 20px;
            line-height: 1.8;
            color: #cbd5e1;
        }

        .tips-list li {
            margin-bottom: 12px;
        }

        .tips-list li::marker {
            color: var(--primary);
        }

        .keyword-badge {
            display: inline-block;
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
            color: #c4b5fd;
            padding: 6px 16px;
            border-radius: 999px;
            font-size: 0.9rem;
            margin-right: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .keyword-badge:hover {
            transform: translateY(-2px);
            background: rgba(139, 92, 246, 0.3);
        }

        input[type="file"] {
            padding: 10px 0;
            color: #94a3b8;
        }

        input[type="file"]::file-selector-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-right: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        input[type="file"]::file-selector-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>

    <!-- Anime.js 3D Background Grid -->
    <div id="anime-background">
        <div class="anime-grid" id="animeGrid"></div>
    </div>

    <!-- Intro Showcase Scene -->
    <div class="intro-container" id="intro-scene">
        <h1 class="intro-title">AI STUDY PAL</h1>
        <p class="intro-subtitle">THE FUTURE OF LEARNING</p>
        <div class="click-to-start">Click anywhere to launch the engine</div>
    </div>

    <!-- Main App Container (Hidden during intro) -->
    <div id="app-wrapper">
        <div class="sidebar">
            <h2>üìö AI Study Pal</h2>
            <ul class="nav-links">
                <li onclick="showSection('study-plan')" class="active" id="nav-study-plan"><span>üìÖ</span> Study Plan
                </li>
                <li onclick="showSection('quiz')" id="nav-quiz"><span>üìù</span> Quiz Generator</li>
                <li onclick="showSection('summarizer')" id="nav-summarizer"><span>‚úÇÔ∏è</span> Summarizer</li>
                <li onclick="showSection('study-tips')" id="nav-study-tips"><span>üí°</span> Study Tips</li>
                <li onclick="showSection('feedback')" id="nav-feedback"><span>üí¨</span> Motivation</li>
            </ul>
        </div>

        <div class="main-content" id="main-scroll">

            <!-- Sections -> same as before -->
            <div id="study-plan" class="section active">
                <h3>Generate Study Plan</h3>
                <p class="subtitle">Architect your perfect week with AI-driven scheduling.</p>
                <div id="subjects-container">
                    <div class="subject-row form-group" style="display: flex; gap: 15px; align-items: flex-end;">
                        <div style="flex:2;"><label>Subject</label><input type="text" class="plan-subject"
                                placeholder="e.g., Quantum Mechanics"></div>
                        <div style="flex:1;"><label>Hours/Week</label><input type="number" class="plan-hours"
                                placeholder="e.g., 5" min="1"></div>
                        <div style="flex:0;"></div>
                    </div>
                </div>
                <button onclick="addSubjectRow()" class="outlined-btn" style="margin-bottom: 25px;">+ Add Another
                    Subject</button>
                <div class="btn-group">
                    <button id="btn-plan" onclick="generatePlan()">Generate Master Plan <div class="spinner"></div>
                    </button>
                    <button id="btn-download" onclick="downloadCSV()" class="success-btn">Download CSV</button>
                </div>
                <div id="plan-output" class="output-area">
                    <h4>Your Weekly Schedule</h4>
                    <div id="plan-table-container"></div>
                </div>
            </div>

            <div id="quiz" class="section">
                <h3>AI Quiz Engine</h3>
                <p class="subtitle">Upload a PDF document to generate a university-level assessment.</p>
                <div class="form-group"
                    style="background: rgba(0,0,0,0.2); padding: 30px; border-radius: 12px; border: 2px dashed rgba(255,255,255,0.1); text-align: center;">
                    <label for="quiz-file" style="font-size: 1.1rem; color: white;">Upload Course Material (PDF)</label>
                    <input type="file" id="quiz-file" accept="application/pdf"
                        style="background: transparent; border: none; padding: 0; box-shadow: none; max-width: 300px; margin: 15px auto 0;">
                </div>
                <button id="btn-quiz" onclick="generateQuiz()" style="margin-top: 10px;">Synthesize Quiz <div
                        class="spinner"></div></button>
                <div id="quiz-output" class="output-area">
                    <h4>Assessment Questions</h4>
                    <div id="quiz-container"></div>
                </div>
            </div>

            <div id="summarizer" class="section">
                <h3>Text Summarizer</h3>
                <p class="subtitle">Distill massive walls of text into high-signal summaries.</p>
                <div class="form-group">
                    <label for="sum-text">Raw Text Input</label>
                    <textarea id="sum-text"
                        placeholder="Paste your massive study material here to compress it..."></textarea>
                </div>
                <button id="btn-summarize" onclick="summarizeText()">Compress Knowledge <div class="spinner"></div>
                </button>
                <div id="sum-output" class="output-area">
                    <h4>Distilled Summary</h4>
                    <p id="sum-result" style="line-height: 1.8; color: #cbd5e1; font-size: 1.05rem;"></p>
                </div>
            </div>

            <div id="study-tips" class="section">
                <h3>Strategic Insights</h3>
                <p class="subtitle">Extract core keywords and actionable tips to master any topic.</p>
                <div class="form-group">
                    <label for="tips-topic">Topic or Concept</label>
                    <textarea id="tips-topic" placeholder="Describe what you are trying to learn..."
                        style="height: 100px;"></textarea>
                </div>
                <button id="btn-tips" onclick="getTips()">Extract Insights <div class="spinner"></div></button>
                <div id="tips-output" class="output-area">
                    <h4>Core Keywords</h4>
                    <div id="keywords-container" style="margin-bottom: 25px;"></div>
                    <h4>Actionable Tactics</h4>
                    <ul id="tips-list" class="tips-list"></ul>
                </div>
            </div>

            <div id="feedback" class="section">
                <h3>Motivational Engine</h3>
                <p class="subtitle">AI-generated motivation when burnout hits hard.</p>
                <div class="form-group">
                    <label for="feed-subject">Current Focus Area</label>
                    <input type="text" id="feed-subject" placeholder="e.g., Organic Chemistry Final">
                </div>
                <button id="btn-feedback" onclick="getFeedback()">Inject Motivation <div class="spinner"></div></button>
                <div id="feed-output" class="output-area">
                    <h4 style="color: transparent; background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%); -webkit-background-clip: text; font-size: 1.8rem; text-align: center; margin: 20px 0; border: none;"
                        id="feed-result"></h4>
                </div>
            </div>

        </div>
    </div>

    <!-- UI Logic & Animations -->
    <script>
        // ----------------------------------------------------
        // 1. ANIME.JS 3D SCENE SETUP
        // ----------------------------------------------------
        const bgContainer = document.getElementById('anime-background');
        const gridEl = document.getElementById('animeGrid');
        const cols = 15; const rows = 12; const total = cols * rows;

        gridEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        gridEl.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

        for (let i = 0; i < total; i++) {
            const item = document.createElement('div');
            item.classList.add('anime-grid-item');
            gridEl.appendChild(item);
        }

        // Floating Particles
        for (let i = 0; i < 30; i++) {
            const p = document.createElement('div');
            p.classList.add('particle');
            p.style.width = Math.random() * 3 + 1 + 'px';
            p.style.height = p.style.width;
            p.style.left = Math.random() * 100 + 'vw';
            p.style.top = Math.random() * 100 + 'vh';
            bgContainer.appendChild(p);

            anime({
                targets: p,
                translateX: () => anime.random(-150, 150),
                translateY: () => anime.random(-150, 150),
                translateZ: () => anime.random(-500, 500),
                opacity: [0, Math.random() * 0.5 + 0.1, 0],
                duration: () => anime.random(4000, 10000),
                delay: () => anime.random(0, 5000),
                loop: true, easing: 'linear'
            });
        }

        // Perspective Tracker
        document.addEventListener('mousemove', (e) => {
            const xAxis = (window.innerWidth / 2 - e.pageX) / 40;
            const yAxis = (window.innerHeight / 2 - e.pageY) / 40;
            bgContainer.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
        });

        // Intro Animations (Plays on load)
        anime({
            targets: '.anime-grid-item',
            scale: [0, 1], opacity: [0, 1],
            translateZ: [anime.stagger([800, -200], { grid: [cols, rows], from: 'center' }), 0],
            delay: anime.stagger(30, { grid: [cols, rows], from: 'center' }),
            easing: 'spring(1, 80, 10, 0)', duration: 2000,
            complete: () => {
                anime({
                    targets: '.anime-grid-item',
                    translateZ: () => anime.random(-30, 30),
                    duration: 3000, delay: anime.stagger(100, { grid: [cols, rows], from: 'center' }),
                    direction: 'alternate', loop: true, easing: 'easeInOutSine'
                });
            }
        });

        anime({
            targets: '.intro-title', opacity: [0, 1], translateY: [50, 0], translateZ: [0, 150],
            easing: 'easeOutExpo', duration: 2500, delay: 1000
        });
        anime({
            targets: '.intro-subtitle', opacity: [0, 1], letterSpacing: ['10px', '4px'],
            easing: 'easeOutExpo', duration: 2500, delay: 1500
        });
        anime({
            targets: '.click-to-start', opacity: [0, 1], easing: 'linear', duration: 1000, delay: 3000
        });

        // ----------------------------------------------------
        // 2. THE TRANSITION: INTRO -> APP
        // ----------------------------------------------------
        let appStarted = false;

        bgContainer.addEventListener('click', (e) => {
            if (appStarted) return;
            appStarted = true;
            bgContainer.style.cursor = 'default';

            // 1. Massive grid wave outward from center
            anime({
                targets: '.anime-grid-item',
                scale: [
                    { value: 0.1, easing: 'easeOutSine', duration: 200 },
                    { value: 1, easing: 'easeInOutQuad', duration: 600 }
                ],
                translateZ: [
                    { value: 200, easing: 'easeOutSine', duration: 200 },
                    { value: 0, easing: 'easeInOutQuad', duration: 600 }
                ],
                backgroundColor: [
                    { value: 'rgba(59, 130, 246, 0.8)', duration: 200 },
                    { value: 'rgba(139, 92, 246, 0.05)', duration: 600 }
                ],
                delay: anime.stagger(40, { grid: [cols, rows], from: 'center' })
            });

            // 2. Blow away the title text
            anime({
                targets: '#intro-scene',
                opacity: [1, 0], scale: [1, 1.5], translateZ: [100, 300],
                duration: 800, easing: 'easeInExpo',
                complete: () => {
                    document.getElementById('intro-scene').style.display = 'none';

                    // 3. Reveal the main App Wrapper
                    const appWrapper = document.getElementById('app-wrapper');
                    appWrapper.style.display = 'flex';
                    anime({ targets: appWrapper, opacity: [0, 1], duration: 800, easing: 'linear' });

                    // 4. Slide in Sidebar
                    anime({
                        targets: '.sidebar',
                        translateX: [-300, 0], opacity: [0, 1],
                        duration: 1200, easing: 'easeOutElastic(1, 0.8)'
                    });

                    // 5. Build first section
                    showSection('study-plan');
                }
            });

            // Allow grid items to ripple freely after start
            setTimeout(() => {
                document.querySelectorAll('.anime-grid-item').forEach((item, index) => {
                    item.addEventListener('click', () => {
                        anime({
                            targets: '.anime-grid-item',
                            scale: [{ value: 0.5, easing: 'easeOutSine', duration: 200 }, { value: 1, easing: 'easeInOutQuad', duration: 400 }],
                            backgroundColor: [{ value: 'rgba(139, 92, 246, 0.8)', duration: 200 }, { value: 'rgba(139, 92, 246, 0.05)', duration: 400 }],
                            delay: anime.stagger(60, { grid: [cols, rows], from: index })
                        });
                    });
                });
            }, 1000);
        });

        // ----------------------------------------------------
        // 3. APP LOGIC
        // ----------------------------------------------------
        const API_BASE = 'http://127.0.0.1:5001/api';

        function showSection(id) {
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.querySelectorAll('.nav-links li').forEach(nav => nav.classList.remove('active'));

            const targetSection = document.getElementById(id);
            if (targetSection) {
                targetSection.classList.add('active');
                animateSectionEntry(targetSection);
            }

            const targetNav = document.getElementById('nav-' + id);
            if (targetNav) targetNav.classList.add('active');
            document.getElementById('main-scroll').scrollTo(0, 0);
        }

        function animateSectionEntry(section) {
            anime({
                targets: section, opacity: [0, 1], translateY: [40, 0], rotateX: [10, 0],
                easing: 'easeOutElastic(1, .8)', duration: 1000
            });
            anime({
                targets: section.querySelectorAll('h3, .subtitle, .form-group, button, .output-area'),
                opacity: [0, 1], translateY: [20, 0], delay: anime.stagger(100),
                easing: 'easeOutQuad', duration: 600
            });
        }

        async function apiCall(endpoint, data, btnId) {
            const btn = document.getElementById(btnId);
            if (btn) { btn.classList.add('loading'); btn.disabled = true; }
            try {
                const response = await fetch(`${API_BASE}/${endpoint}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                alert("An error occurred. Make sure the backend Flask app is running on port 5001.");
                return null;
            } finally {
                if (btn) { btn.classList.remove('loading'); btn.disabled = false; }
            }
        }

        function addSubjectRow() {
            const container = document.getElementById('subjects-container');
            const row = document.createElement('div');
            row.className = 'subject-row form-group';
            row.style.display = 'flex'; row.style.gap = '15px'; row.style.alignItems = 'flex-end';
            row.innerHTML = `
                <div style="flex:2;"><input type="text" class="plan-subject" placeholder="Subject"></div>
                <div style="flex:1;"><input type="number" class="plan-hours" placeholder="Hours" min="1"></div>
                <div style="flex:0;"><button onclick="this.parentElement.parentElement.remove()" style="background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #ef4444; padding: 15px; box-shadow: none;">X</button></div>
            `;
            container.appendChild(row);
            anime({ targets: row, opacity: [0, 1], translateX: [-20, 0], easing: 'easeOutQuad', duration: 400 });
        }

        async function generatePlan() {
            const subjects = [];
            document.querySelectorAll('.subject-row').forEach(row => {
                const subj = row.querySelector('.plan-subject').value;
                const hrs = row.querySelector('.plan-hours').value;
                if (subj.trim()) subjects.push({ subject: subj.trim(), hours: parseInt(hrs) || 1 });
            });
            if (subjects.length === 0) return alert("Please add at least one subject.");
            const result = await apiCall('study-plan', { subjects }, 'btn-plan');
            if (result && result.plan) {
                let html = '<table><tr><th>Day</th><th>Subject</th><th>Hours</th><th>Activity</th></tr>';
                result.plan.forEach(row => {
                    html += `<tr><td><strong style="color: #a855f7;">${row.day}</strong></td><td>${row.subject}</td><td>${row.hours} hr</td><td>${row.activity}</td></tr>`;
                });
                html += '</table>';
                const outputArea = document.getElementById('plan-output');
                document.getElementById('plan-table-container').innerHTML = html;
                outputArea.classList.add('visible');
                anime({ targets: outputArea, opacity: [0, 1], translateY: [20, 0], easing: 'easeOutQuad', duration: 500 });
            }
        }

        function downloadCSV() {
            const subjects = [];
            document.querySelectorAll('.subject-row').forEach(row => {
                const subj = row.querySelector('.plan-subject').value;
                const hrs = row.querySelector('.plan-hours').value;
                if (subj.trim()) subjects.push(`${encodeURIComponent(subj.trim())}:${parseInt(hrs) || 1}`);
            });
            if (subjects.length === 0) return alert("Please add at least one subject first.");
            window.location.href = `${API_BASE}/download?data=${subjects.join(',')}`;
        }

        async function generateQuiz() {
            const fileInput = document.getElementById('quiz-file');
            if (fileInput.files.length === 0) return alert("Please upload a PDF file.");
            const btn = document.getElementById('btn-quiz');
            if (btn) { btn.classList.add('loading'); btn.disabled = true; }
            let result = null;
            try {
                const formData = new FormData(); formData.append('file', fileInput.files[0]);
                const response = await fetch(`${API_BASE}/quiz`, { method: 'POST', body: formData });
                result = await response.json();
            } catch (error) {
                alert("An error occurred generating the quiz.");
            } finally { if (btn) { btn.classList.remove('loading'); btn.disabled = false; } }

            if (result && result.questions) {
                let html = '';
                if (result.questions.length === 0) { html = "<p>Could not generate questions.</p>"; }
                else {
                    result.questions.forEach((q, i) => {
                        html += `<div class="question-card quiz-item">
                            <p style="margin-top: 5px; font-size: 1.1rem;"><strong style="color: var(--primary);">Q${i + 1}:</strong> ${q.question}<br><small style="display: inline-block; margin-top: 8px; padding: 4px 10px; background: rgba(255,255,255,0.1); border-radius: 4px; font-size: 0.8rem;">Difficulty: <span style="font-weight: 600; color: #a855f7;">${q.difficulty}</span></small></p>
                            <ul class="options-list">`;
                        const shuffled = [...q.options].sort(() => 0.5 - Math.random());
                        shuffled.forEach((opt, optIdx) => {
                            html += `<li><input type="radio" name="q${i}" id="q${i}_opt${optIdx}" value="${opt}"><label for="q${i}_opt${optIdx}">${opt}</label></li>`;
                        });
                        html += `</ul><div style="margin-top: 15px;"><button onclick="alert('Correct Answer:\\n' + decodeURIComponent('${encodeURIComponent(q.answer)}'))" class="outlined-btn" style="padding: 8px 16px; font-size: 0.9rem;">Reveal Answer</button></div></div>`;

                    });
                }
                const outputArea = document.getElementById('quiz-output');
                document.getElementById('quiz-container').innerHTML = html;
                outputArea.classList.add('visible');
                anime({ targets: '.quiz-item', opacity: [0, 1], translateY: [30, 0], delay: anime.stagger(150), easing: 'easeOutElastic(1, .8)', duration: 800 });
            }
        }

        async function summarizeText() {
            const text = document.getElementById('sum-text').value;
            if (!text.trim()) return alert("Please enter text.");
            const result = await apiCall('summarize', { text }, 'btn-summarize');
            if (result && result.summary) {
                const outputArea = document.getElementById('sum-output');
                document.getElementById('sum-result').innerText = result.summary;
                outputArea.classList.add('visible');
                anime({ targets: outputArea, opacity: [0, 1], scale: [0.95, 1], easing: 'easeOutQuad', duration: 400 });
            }
        }

        async function getTips() {
            const topic = document.getElementById('tips-topic').value;
            if (!topic.trim()) return alert("Please enter a topic.");
            const result = await apiCall('tips', { topic }, 'btn-tips');
            if (result) {
                const kwContainer = document.getElementById('keywords-container');
                kwContainer.innerHTML = '';
                if (result.keywords && result.keywords.length > 0) {
                    result.keywords.forEach(kw => {
                        const span = document.createElement('span'); span.className = 'keyword-badge kw-animate'; span.innerText = kw; kwContainer.appendChild(span);
                    });
                }
                const tipsList = document.getElementById('tips-list');
                tipsList.innerHTML = '';
                if (result.tips && result.tips.length > 0) {
                    result.tips.forEach(tip => {
                        const li = document.createElement('li'); li.className = 'tip-animate'; li.innerText = tip; tipsList.appendChild(li);
                    });
                }
                document.getElementById('tips-output').classList.add('visible');
                anime({ targets: '.kw-animate', opacity: [0, 1], scale: [0.8, 1], delay: anime.stagger(100), easing: 'easeOutBack', duration: 500 });
                anime({ targets: '.tip-animate', opacity: [0, 1], translateX: [-20, 0], delay: anime.stagger(150, { start: 300 }), easing: 'easeOutQuad', duration: 500 });
            }
        }

        async function getFeedback() {
            const subject = document.getElementById('feed-subject').value || 'your studies';
            const result = await apiCall('feedback', { subject }, 'btn-feedback');
            if (result && result.message) {
                const outputArea = document.getElementById('feed-output');
                const resultText = document.getElementById('feed-result');
                resultText.innerText = "‚ú® " + result.message + " ‚ú®";
                outputArea.classList.add('visible');
                anime({ targets: resultText, opacity: [0, 1], scale: [0.5, 1], rotateX: [-90, 0], easing: 'spring(1, 80, 10, 0)', duration: 1500 });
                anime({
                    targets: '.anime-grid-item', scale: [{ value: 0.5, easing: 'easeOutSine', duration: 250 }, { value: 1, easing: 'easeInOutQuad', duration: 500 }],
                    backgroundColor: [{ value: 'rgba(59, 130, 246, 0.8)', duration: 250 }, { value: 'rgba(139, 92, 246, 0.05)', duration: 500 }],
                    delay: anime.stagger(50, { grid: [cols, rows], from: 'center' })
                });
            }
        }
    </script>
</body>

</html>